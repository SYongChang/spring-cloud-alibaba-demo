<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scf.mapper.MiniprogramUserMapper">

    <!-- 根据openid查询用户 -->
    <select id="selectByOpenid" parameterType="string" resultType="org.scf.entity.user.MiniprogramUser">
        SELECT * FROM miniprogram_user 
        WHERE openid = #{openid} AND deleted = 0
    </select>

    <!-- 根据手机号查询用户 -->
    <select id="selectByPhone" parameterType="string" resultType="org.scf.entity.user.MiniprogramUser">
        SELECT * FROM miniprogram_user 
        WHERE phone = #{phone} AND deleted = 0
    </select>

    <!-- 根据邮箱查询用户 -->
    <select id="selectByEmail" parameterType="string" resultType="org.scf.entity.user.MiniprogramUser">
        SELECT * FROM miniprogram_user 
        WHERE email = #{email} AND deleted = 0
    </select>

    <!-- 更新用户最后登录信息 -->
    <update id="updateLastLoginInfo">
        UPDATE miniprogram_user 
        SET last_login_time = NOW(), 
            last_login_ip = #{loginIp},
            update_time = NOW()
        WHERE id = #{userId} AND deleted = 0
    </update>

    <!-- 增加用户登录次数 -->
    <update id="incrementLoginCount">
        UPDATE miniprogram_user 
        SET login_count = login_count + 1,
            update_time = NOW()
        WHERE id = #{userId} AND deleted = 0
    </update>

</mapper>
